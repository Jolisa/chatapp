/**
 * 
 */
package jmb26_wmj1.chatapp.util;

import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.List;

import common.IChatAppConnector;
import common.IChatAppReceiver;
import common.IChatRoomConnector;
import jmb26_wmj1.chatapp.client.model.IMain2MiniAdapter;
import jmb26_wmj1.chatapp.client.model.IModel2ViewAdapter;

/**
 * @author wj
 *
 */
public class ChatAppConnector implements IChatAppConnector {
	
	/**
	 * The user name
	 */
	private String name;

	
	/**
	 * The set of chat rooms this user is currently in
	 */
	private List<IChatRoomConnector> rooms;
	/**
	 * The Model to View adapter
	 */
	private IModel2ViewAdapter m2vAdpt;
	/**
	 * The stub to this user
	 */
	private IChatAppConnector userStub;
	
	public ChatAppConnector(String name, IModel2ViewAdapter _m2vAdpt) {
		this.name = name;
		this.rooms = new ArrayList<>();
		this.m2vAdpt = _m2vAdpt;

	}

	@Override
	public String getName() throws RemoteException {
		// TODO Auto-generated method stub
		return name;
	}
	
	

	@Override
	public void invite(IChatRoomConnector connector) throws RemoteException {
		// TODO Auto-generated method stub
		if (!rooms.contains(connector)) {
			IChatRoomConnector roomCopy = new ChatRoomConnector(connector.getChatRoomName());
			// add all exisiting members to this room
			for (IChatAppReceiver repStub: connector.getAllReceivers()) {
				//roomCopy.addRep(repStub);
				roomCopy.getAllReceivers().add(repStub);
			}
			// tell everybody to add you
			IMain2MiniAdapter m2mAdpt = m2vAdpt.makeMiniMVC(roomCopy, userStub);
			m2vAdpt.addChatroom(m2mAdpt.getMiniRoom());
		}
		
		
		
	}

	@Override
	public List<IChatRoomConnector> request() throws RemoteException {
		// TODO Auto-generated method stub
		System.out.println("in chat app connector, rooms: " + rooms);
		System.out.println("in chat app connector, rooms: " + this.rooms);
		return rooms;
	}

	@Override
	public void autoConnect(IChatAppConnector connector) throws RemoteException {
		// TODO Auto-generated method stub
		m2vAdpt.addUser(connector);
		
	}

	@Override
	public void disconnect(IChatAppConnector connector) throws RemoteException {
		// TODO Auto-generated method stub
		
	}
	
	public void setUserStub(IChatAppConnector userStub) {
		this.userStub = userStub; 
	}
	
	@Override
	public String toString() {
		return name; 
	}

	////////////////// this one 
	@Override
	public List<IChatAppConnector> getIChatAppConnectors() throws RemoteException {
		// TODO Auto-generated method stub
		return null;
	}

}
